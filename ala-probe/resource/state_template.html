<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
</head>
<body>
    <div id="app">
        
    </div>
    <script>
        $(document).ready(function(){
            setInterval(function(){
                $.ajax({
                type: "GET",
                dataType: "json",
                //url: "http://localhost:8080/state",
                url: {{.Url}},
                success: function(result){
                    var parentDiv = "<div>";
                    
                    if (typeof result.RED != 'undefined'){
                        var redDiv = "<div>" + createElement(sort(result.RED), "red") + "</div>";
                        parentDiv+=redDiv
                    }
                    if (typeof result.GREEN != 'undefined'){
                        var greenDiv = "<div>" + createElement(sort(result.GREEN), "green") + "</div>";
                        parentDiv+=greenDiv 
                    }
                    
                    parentDiv+=" </div>";
                    //$(parentDiv).append(redDiv);
                    $("#app").html(parentDiv);
                    
                    
                },
                error: function(jqXHR, exception) {
                   if (jqXHR.status === 0) {
                       alert('Not connect.\n Verify Network.');
                   } else if (jqXHR.status == 404) {
                       alert('Requested page not found. [404]');
                   } else if (jqXHR.status == 500) {
                       alert('Internal Server Error [500].');
                   } else if (exception === 'parsererror') {
                       alert('Requested JSON parse failed.');
                   } else if (exception === 'timeout') {
                       alert('Time out error.');
                   } else if (exception === 'abort') {
                       alert('Ajax request aborted.');
                   } else {
                       alert('Uncaught Error.\n' + jqXHR.responseText);
                   }
                }
            });
            },{{.RefreshTimeMs}});
            function createElement(apiList, color){
                if(apiList === undefined || apiList.length ==0){
                    return ;
                }
                var ele = "<ul>";
                    for(var i = 0; i < apiList.length; i++) {
                        ele += "<li style='color :"+color+" '>" + JSON.stringify(apiList[i]) + "</li>";
                    }
                    ele += "</ul>";


                    return ele;
            }
            function sort(apiList){
                return apiList.sort(function(a, b){
                    if(a.method < b.method) return -1;
                    else if(a.method > b.method) return 1;
                    else if(a.url <b.url) return -1
                    else if(a.url >b.url) return 1
                    return 0;
                });
            }
            
        });
    </script>
</body>
</html>
